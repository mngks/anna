<!-- app/views/messages/index.html.erb -->
<span class="mt-3"></span>
<div class="container my-5">
    <h3>
        <%= cl_image_tag @food.donor.user.photo, class: "avatar-mid mr-2" %>
        Chat with @
        <%= @food.donor.user.username %>
    </h3>
    <%= link_to food_path(@food) do%>
    <% coordinates = [ @food.latitude , @food.longitude ] %>
    <div class="big-card card-index-page">
        <%= cl_image_tag @food.photo%>
        <div class="big-card-infos">
            <div>
                <h2 style="color: $text-dark">
                    <%= @food.name %>
                </h2>
            </div>
            <div class="big-card-location" data-coordinates="<%= coordinates.to_json %>">
            </div>
        </div>
    </div>
    <% end %>
    <% if @donation.food.donor.user == current_user %>
    <% if @donation.confirmed %>
    <% else%>
    <div class="btn btn-secondary mb-3">
        <%= simple_form_for @donation do |f| %>
        <%= f.hidden_field :confirmed, value:true %>
        <%= f.submit "Accept Request" %>
        <% end %>
        <% end %>
        <% end %>
    </div>
    <div class="mb4">
        <% @messages.each do |message| %>
        <% if message.content %>
        <% user = User.find(message.user.id) %>
        <% message.check_if_read(current_user) if !message.read %>
        <%= render 'message', message: message %>
        <% end %>
        <% end %>
    </div>
    <div class="form-group mb-5">
        <%= simple_form_for [@donation, @message] do |f| %>
        <%= f.text_field :content, placeholder: "Your message", class: "form-control"%>
        <%= f.hidden_field :user, value: current_user %>
        <%= f.submit "Send Message", class: "btn btn-primary w-100 my-3" %>
        <% end %>
    </div>
</div>
