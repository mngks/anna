<!-- app/views/messages/index.html.erb -->
<div class="navbar navbar-expand-sm navbar-light navbar-lewagon align-items-center w-100">
    <%= link_to user_donations_path(current_user) do  %>
    <i class="fas fa-chevron-left"></i>
    <% end %>
    <%= cl_image_tag @food.donor.user.photo, class: "avatar-sm mr-2" %>
    <p class="mb-0"><strong> Chat with @<%= current_user == @donation.user ? @food.donor.user.username : @donation.user.username %>
           </strong>
    </p>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Messages</a>
            </li>
            <li class="nav-item dropdown">
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                </div>
            </li>
        </ul>
    </div>
</div>
<%= link_to food_path(@food) do%>

<% coordinates = [ @food.latitude , @food.longitude ] %>
<div class="product-card w-100 mx-0 mb-3">
    <%= cl_image_tag @food.photo%>
    <div class="product-card-infos">
        <h2 style="color: $text-dark">
            <%= @food.name %>
        </h2>
        <% end %>
        <% if @donation.confirmed %>
        <p> Meeting confirmed.</p>
        <% end %>
    </div>

    <% if @donation.food.donor.user == current_user %>
      <% if @donation.confirmed %>
       <%= simple_form_for @donation do |f| %>
          <%= f.hidden_field :confirmed, value:false %>
          <%= f.submit "Cancel", class: "btn btn-primary" %>
        <% end %>

      <% else %>
 <%= simple_form_for @donation do |f| %>
          <%= f.hidden_field :confirmed, value:true %>
          <%= f.submit "Accept", class: "btn btn-primary" %>
        <% end %>


      <% end %>
    <% end %>
</div>

<div class="mb4">
    <% @messages.each do |message| %>
    <% if message.content %>
    <% user = User.find(message.user.id) %>
    <% message.check_if_read(current_user) if !message.read %>
    <%= render 'message', message: message %>
    <% end %>
    <% end %>
</div>
<div class="form-group mb-5">
    <%= simple_form_for [@donation, @message] do |f| %>
    <%= f.text_field :content, placeholder: "Your message", class: "form-control"%>
    <%= f.hidden_field :user, value: current_user %>
    <%= f.submit "Send Message", class: "btn btn-primary w-100 my-3" %>
    <% end %>
</div>
